<!-- src/app/features/dashboard/dashboard.html -->

<div class="dashboard">

  <div class="greeting">
    <h2>Good Morning, Joe</h2>
    <p>Sunday, 27th December 2026</p>
  </div>

  <div class="stats-banner">
    <div class="stat-card">
      <span class="stat-label">Active Orders</span>
      <span class="stat-value">{{ totalActiveOrdersCount() }}</span>
    </div>
    <div class="stat-card">
      <span class="stat-label">Tables Occupied</span>
      <span class="stat-value">{{ occupiedTablesCount() }}/{{ totalTablesCount() }}</span>
    </div>
    <div class="stat-card">
      <span class="stat-label">Today's Total</span>
      <span class="stat-value">‚Çπ{{ totalSalesToday() | number:'1.0-0' }}</span>
    </div>
  </div>

  <div class="hero-actions">
    <div class="hero-card dining" (click)="navigateToDining()">
      <div class="hero-icon">
        <img src="/icons/tablewhite.png" alt="Dining">
      </div>
      <div class="hero-info">
        <h3>Dining</h3>
        <p>Manage tables & dine-in orders</p>
      </div>
    </div>

    <div class="hero-card parcel" (click)="navigateToParcel()">
      <div class="hero-icon">
        <img src="/icons/listwhite.png" alt="Parcel">
      </div>
      <div class="hero-info">
        <h3>Parcels</h3>
        <p>Create new takeaway orders</p>
      </div>
    </div>
  </div>

  <div class="section-title">
    <h3>Active Orders</h3>
  </div>

  <div class="content">

    <div class="orders-grid">
      @for (order of activeOrders(); track order.id) {
      <div class="order-card" [class.selected]="selectedOrder()?.id === order.id" (click)="selectOrder(order)">

        <div class="avatar" [style.background-color]="order.avatarColor || '#EA6868'">
          {{ order.avatarInitials }}
        </div>

        <div class="main-info">
          <div class="customer-name">{{ order.customerName }}</div>
          <div class="order-meta">
            {{ order.orderNumber }} / {{ order.type }}
            @if (order.table) {
            <br>Table ‚Üí {{ order.table }}
            }
          </div>
          <div class="timestamp">{{ order.timestamp }}</div>
        </div>

        <div class="right-column">
          <div class="status-line">
            <span class="status">{{ order.status }}</span>
            @if (order.status === 'Ready to Serve') {
            <span class="ready-badge">Ready</span>
            }
          </div>
          <div class="item-count">{{ order.itemsCount }} Item{{ order.itemsCount !== 1 ? 's' : '' }}</div>
          <div class="total-line">
            <span class="total-label">Total</span>
            <span class="total-amount">‚Çπ {{ order.total | number:'1.2-2' }}</span>
          </div>
        </div>
      </div>
      } @empty {
      <div class="empty-state">No orders available</div>
      }
    </div>

    @if (selectedOrder(); as order) {
    <div class="order-details">

      <!-- Header -->
      <div class="order-header">
        <div class="customer-name">Will Byrce</div>
        <div class="order-type-badge">#{{ order.orderNumber }} / {{ order.type }}</div>
      </div>

      <div class="order-meta">
        <div class="timestamp">{{ order.timestamp || 'February 09, 2025 at 09:28:48 PM' }}</div>
      </div>

      <!-- Items -->
      @for (item of order.items ?? []; track $index) {
      <div class="order-item">
        <div class="item-left">
          <span class="item-name">{{ item.name }}</span>
          <div class="item-controls">
            <!-- Fixed: clean event bindings, no extra characters -->
            <button class="action-icon delete">üóëÔ∏è</button>
            <button class="action-icon collect">üì¶</button>
          </div>
        </div>
        <div class="item-right">
          <span class="quantity">x{{ item.quantity }}</span>
          <span class="price">‚Çπ{{ (item.price * item.quantity) || 120 | number:'1.0-0' }}</span>
        </div>
      </div>
      }

      <!-- Summary -->
      <div class="summary">
        <div class="summary-row">
          <span>Items ({{ order.items?.length || order.itemsCount || 0 }})</span>
          <span>‚Çπ{{ order.total | number:'1.0-0' }}</span>
        </div>
        <div class="summary-row tax">
          <span>Tax</span>
          <span>‚Çπ20</span>
        </div>
      </div>

      <!-- Buttons -->
      <div class="action-buttons">
        <button class="btn print">Cash</button>
        <button class="btn place">Online</button>
        <button class="btn print">Print Receipt</button>
        <button class="btn place">Place Order</button>
      </div>

    </div>
    } @else {
    <div class="order-details empty">
      <p>Select an order to see details</p>
    </div>
    }

  </div>



</div>